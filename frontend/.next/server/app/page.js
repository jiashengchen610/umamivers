(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2836:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>g,tree:()=>d});var r=a(7096),s=a(6132),l=a(7284),i=a.n(l),n=a(2564),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);a.d(t,o);let d=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,8203)),"/Users/chenjiashe/Desktop/Umamivers/frontend/src/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,9113)),"/Users/chenjiashe/Desktop/Umamivers/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9291,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/chenjiashe/Desktop/Umamivers/frontend/src/app/page.tsx"],m="/page",u={require:a,loadChunk:()=>Promise.resolve()},g=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},5454:(e,t,a)=>{Promise.resolve().then(a.bind(a,3963))},3963:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>HomePage});var r=a(784),s=a(9885),l=a(323),i=a(9518),n=a(6206),o=a(5808),d=a(9458),c=a(4050);let m=process.env.NEXT_PUBLIC_API_URL?`${process.env.NEXT_PUBLIC_API_URL}/api`:"/api";let APIError=class APIError extends Error{constructor(e,t){super(e),this.status=t,this.name="APIError"}};async function fetchAPI(e,t={}){let a=`${m}${e}`,r=await fetch(a,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!r.ok){let e=await r.text();throw new APIError(`API Error: ${r.statusText} - ${e}`,r.status)}return r.json()}function buildSearchParams(e){let t=new URLSearchParams;if(e.query&&t.set("q",e.query),e.sort&&"synergy"!==e.sort&&t.set("sort",e.sort),e.umami?.forEach(e=>t.append("umami[]",e)),e.flavor?.forEach(e=>t.append("flavor[]",e)),e.qi?.forEach(e=>t.append("qi[]",e)),e.flavors?.forEach(e=>t.append("flavors[]",e)),e.meridians?.forEach(e=>t.append("meridians[]",e)),e.allergens_include?.forEach(e=>t.append("allergens_include[]",e)),e.allergens_exclude?.forEach(e=>t.append("allergens_exclude[]",e)),e.dietary?.forEach(e=>t.append("dietary[]",e)),e.category?.forEach(e=>t.append("category[]",e)),e.ranges){let{ranges:a}=e;void 0!==a.aa_min&&t.set("aa_min",a.aa_min.toString()),void 0!==a.aa_max&&t.set("aa_max",a.aa_max.toString()),void 0!==a.nuc_min&&t.set("nuc_min",a.nuc_min.toString()),void 0!==a.nuc_max&&t.set("nuc_max",a.nuc_max.toString()),void 0!==a.syn_min&&t.set("syn_min",a.syn_min.toString()),void 0!==a.syn_max&&t.set("syn_max",a.syn_max.toString())}return t}async function searchIngredients(e={},t=1,a=24){let r=buildSearchParams(e);return r.set("page",t.toString()),r.set("page_size",a.toString()),fetchAPI(`/ingredients/?${r.toString()}`)}async function getIngredient(e){return fetchAPI(`/ingredients/${e}/`)}async function composePreview(e){return fetchAPI("/ingredients/compose_preview/",{method:"POST",body:JSON.stringify(e)})}function loadFromLocalStorage(e){return null}let u=[{value:"relevance",label:"Relevance"},{value:"synergy",label:"Synergy"},{value:"aa",label:"Amino Acids"},{value:"nuc",label:"Nucleotides"},{value:"tcm",label:"TCM"},{value:"alpha",label:"A→Z"}];function FilterChip({label:e,onRemove:t,className:a=""}){return(0,r.jsxs)("div",{className:`inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full ${a}`,children:[r.jsx("span",{children:e}),r.jsx("button",{onClick:t,className:"btn-circular-sm hover:bg-blue-200 w-4 h-4",children:r.jsx(n.Z,{className:"w-2.5 h-2.5"})})]})}function FilterDropdown({title:e,options:t,selectedValues:a,onChange:l,className:i=""}){let[n,o]=(0,s.useState)(!1),[c,m]=(0,s.useState)(null),u=(0,s.useRef)(null),toggleOption=e=>{let t=a.includes(e)?a.filter(t=>t!==e):[...a,e];l(t)};return(0,r.jsxs)("div",{className:`relative ${i}`,children:[(0,r.jsxs)("button",{ref:u,onClick:n?()=>o(!1):()=>{u.current&&m(u.current.getBoundingClientRect()),o(!0)},className:"flex items-center gap-1 px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm whitespace-nowrap flex-shrink-0",children:[r.jsx("span",{children:e}),a.length>0&&r.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs rounded-full px-2 py-0.5",children:a.length}),r.jsx(d.Z,{className:"w-4 h-4"})]}),n&&c&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>o(!1)}),r.jsx("div",{className:"fixed w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto",style:{top:c.bottom+window.scrollY+4,left:c.left+window.scrollX},children:t.map(e=>(0,r.jsxs)("label",{className:"flex items-center gap-2 px-3 py-2 hover:bg-gray-50 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:a.includes(e.value),onChange:()=>toggleOption(e.value),className:"rounded border-gray-300"}),r.jsx("span",{className:"text-sm",children:e.label})]},e.value))})]})]})}function FilterRow({filters:e,onChange:t,resultCount:a,compact:s=!1,className:l="",onClearFilters:i,showResultCount:n=!0}){let o=[{value:"umami_aa",label:"Umami AA"},{value:"umami_nuc",label:"Umami Nuc"},{value:"umami_synergy",label:"Umami Synergy"}],d=[{value:"flavor_supporting",label:"Flavor Supporting"},{value:"flavor_carrier",label:"Flavor Carrier"}],c=[{value:"Hot",label:"Hot"},{value:"Warm",label:"Warm"},{value:"Neutral",label:"Neutral"},{value:"Cool",label:"Cool"},{value:"Cold",label:"Cold"}],m=[{value:"Sweet",label:"Sweet"},{value:"Salty",label:"Salty"},{value:"Sour",label:"Sour"},{value:"Bitter",label:"Bitter"},{value:"Pungent",label:"Pungent"},{value:"Astringent",label:"Astringent"}],u=[{value:"Spleen",label:"Spleen"},{value:"Stomach",label:"Stomach"},{value:"Lung",label:"Lung"},{value:"Kidney",label:"Kidney"},{value:"Liver",label:"Liver"},{value:"Heart",label:"Heart"}],g=(()=>{let a=[];return e.umami.forEach(r=>{let s=o.find(e=>e.value===r);s&&a.push({label:s.label,onRemove:()=>t({...e,umami:e.umami.filter(e=>e!==r)})})}),e.flavor.forEach(r=>{let s=d.find(e=>e.value===r);s&&a.push({label:s.label,onRemove:()=>t({...e,flavor:e.flavor.filter(e=>e!==r)})})}),e.qi.forEach(r=>{let s=c.find(e=>e.value===r);s&&a.push({label:`Qi: ${s.label}`,onRemove:()=>t({...e,qi:e.qi.filter(e=>e!==r)})})}),e.flavors.forEach(r=>{let s=m.find(e=>e.value===r);s&&a.push({label:`Taste: ${s.label}`,onRemove:()=>t({...e,flavors:e.flavors.filter(e=>e!==r)})})}),e.meridians.forEach(r=>{let s=u.find(e=>e.value===r);s&&a.push({label:`Meridian: ${s.label}`,onRemove:()=>t({...e,meridians:e.meridians.filter(e=>e!==r)})})}),a})();return(0,r.jsxs)("div",{className:l,children:[(0,r.jsxs)("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide whitespace-nowrap",children:[r.jsx(FilterDropdown,{title:"Umami",options:o,selectedValues:e.umami,onChange:a=>t({...e,umami:a})}),r.jsx(FilterDropdown,{title:"Flavor Role",options:d,selectedValues:e.flavor,onChange:a=>t({...e,flavor:a})}),r.jsx(FilterDropdown,{title:"TCM Four Qi",options:c,selectedValues:e.qi,onChange:a=>t({...e,qi:a})}),r.jsx(FilterDropdown,{title:"TCM Five Tastes",options:m,selectedValues:e.flavors,onChange:a=>t({...e,flavors:a})}),r.jsx(FilterDropdown,{title:"Meridians",options:u,selectedValues:e.meridians,onChange:a=>t({...e,meridians:a})})]}),g.length>0&&(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[r.jsx("div",{className:"flex flex-wrap gap-1",children:g.map((e,t)=>r.jsx(FilterChip,{label:e.label,onRemove:e.onRemove},t))}),i&&r.jsx("button",{onClick:i,className:"px-2 py-1 text-xs text-black hover:text-gray-700",children:"Clear filters"})]}),n&&(0,r.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[a.toLocaleString()," results"]})]})}function SortSelect({value:e,onChange:t,className:a=""}){let[l,i]=(0,s.useState)(!1),[n,o]=(0,s.useState)(!1),d=(0,s.useRef)(null);return((0,s.useEffect)(()=>{let e=window.matchMedia("(max-width: 639px)"),update=()=>i(e.matches);return update(),e.addEventListener("change",update),()=>e.removeEventListener("change",update)},[]),(0,s.useEffect)(()=>{if(!n)return;let handleClickOutside=e=>{d.current&&!d.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",handleClickOutside),()=>document.removeEventListener("mousedown",handleClickOutside)},[n]),l)?(0,r.jsxs)("div",{ref:d,className:`relative ${a}`,children:[r.jsx("button",{type:"button",onClick:()=>o(e=>!e),className:"p-2 border border-gray-300 rounded-lg text-gray-600 hover:text-gray-800 hover:border-gray-400","aria-label":"Sort ingredients",children:r.jsx(c.Z,{className:"w-4 h-4"})}),n&&r.jsx("div",{className:"absolute right-0 mt-2 w-36 bg-white border border-gray-200 rounded-lg shadow-lg z-20",children:u.map(a=>r.jsx("button",{type:"button",onClick:()=>{t(a.value),o(!1)},className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-100 ${e===a.value?"bg-gray-100 text-gray-900 font-medium":"text-gray-600"}`,children:a.label},a.value))})]}):r.jsx("select",{value:e,onChange:e=>t(e.target.value),className:`px-3 py-2 border border-gray-300 rounded-lg text-sm whitespace-nowrap ${a}`,children:u.map(e=>(0,r.jsxs)("option",{value:e.value,children:["Sort: ",e.label]},e.value))})}let g=new Set(["halal","kosher"]),x={dairy:"Dairy",milk:"Milk",lactose:"Lactose",egg:"Eggs",eggs:"Eggs",fish:"Fish",shellfish:"Shellfish",crustacean:"Crustaceans",crustaceans:"Crustaceans",mollusk:"Molluscs",molluscs:"Molluscs",soy:"Soy",soya:"Soy",peanut:"Peanuts",peanuts:"Peanuts",tree_nut:"Tree nuts",tree_nuts:"Tree nuts",nuts:"Nuts",sesame:"Sesame",gluten:"Gluten",wheat:"Wheat",barley:"Barley",rye:"Rye",oats:"Oats",mustard:"Mustard",celery:"Celery",lupin:"Lupin",sulphite:"Sulphites",sulphites:"Sulphites",sulphur_dioxide:"Sulphur dioxide"},h={vegan:"Vegan",vegetarian:"Vegetarian",pescatarian:"Pescatarian",gluten_free:"Gluten free",dairy_free:"Dairy free",nut_free:"Nut free",soy_free:"Soy free",egg_free:"Egg free",halal:"Halal",kosher:"Kosher",keto:"Keto",paleo:"Paleo",low_fodmap:"Low FODMAP"},humanize=e=>e.replace(/[\s_-]+/g," ").trim().replace(/\b\w/g,e=>e.toUpperCase()),formatTag=(e,t)=>{let a=e.toLowerCase().replace(/[\s-]+/g,"_");return t[a]??humanize(e)};function TagRow({items:e,label:t,map:a}){if(!e||0===e.length)return null;let s=e.map(e=>e?.trim()).filter(Boolean);if(0===s.length)return null;let l=s.slice(0,3),i=s.length-l.length;return(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-1 text-xs","aria-label":t,role:"list",children:[r.jsx("span",{className:"sr-only",children:t}),l.map(e=>{let s=formatTag(e,a);return r.jsx("span",{role:"listitem",className:"tag-element px-2 py-1 bg-gray-100 text-gray-700 border border-gray-300 whitespace-nowrap",title:s,children:s},`${t}-${e}`)}),i>0&&(0,r.jsxs)("span",{role:"listitem",className:"tag-element px-2 py-1 bg-gray-100 text-gray-700 border border-gray-300 whitespace-nowrap",title:`${i} more ${t.toLowerCase()}`,children:["+",i]})]})}function IngredientCard({ingredient:e,onAddToComposition:t,onOpenDetails:a,compact:s=!1,className:l=""}){let i=e.display_name||e.base_name,n=e.chemistry,o=e.tcm,d=e.flags,c=o?.five_flavors??[],m=o?.four_qi??[],u=c.length>0||m.length>0,p=d?.allergens??[],y=d?.dietary_restrictions??[],f=y.filter(e=>{let t=e.toLowerCase().replace(/[\s-]+/g,"_");return g.has(t)}),v=f.map(e=>formatTag(e,h)),b=v.slice(0,2).join(", "),j=v.slice(2,4),N=Math.max(0,v.length-4),w=j.join(", ");N>0&&(w=w?`${w} +${N}`:`+${N}`);let _=d?.flavor_tags?.includes("flavor_supporting")?"Flavor Supporting":d?.flavor_tags?.includes("flavor_carrier")?"Flavor Carrier":d?.umami_tags?.includes("umami_carrier")?"Umami Carrier":n?.umami_aa&&n?.umami_nuc?"High Umami (AA+Nuc)":n?.umami_aa&&n.umami_aa>(n?.umami_nuc||0)?"High Umami(AA)":"Ingredient";return(0,r.jsxs)("div",{className:`paper-texture-light border border-gray-200 hover:border-gray-300 hover:bg-gray-50 transition-all ${s?"p-2 sm:p-3":"p-3 sm:p-4"} ${l} flex flex-col h-full ${a?"cursor-pointer":""}`,onClick:()=>{a&&a(e)},onKeyDown:t=>{a&&("Enter"===t.key||" "===t.key)&&(t.preventDefault(),a(e))},role:a?"button":void 0,tabIndex:a?0:void 0,children:[(0,r.jsxs)("div",{className:"space-y-2 sm:space-y-3",children:[(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-xs text-gray-500 mb-1",children:_}),r.jsx("h3",{className:"font-medium text-gray-900 text-sm leading-tight min-h-[2.5rem] overflow-hidden text-ellipsis",title:i,children:i})]}),n&&r.jsx("div",{className:"w-full",children:(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[r.jsx("div",{className:"chart-element w-2 h-2 bg-orange-500 flex-shrink-0"}),r.jsx("div",{className:"chart-element flex-1 h-1.5 bg-gray-200 overflow-hidden min-w-0",children:r.jsx("div",{className:"h-full bg-orange-500 transition-all duration-300",style:{width:`${Math.min(100,parseFloat(n.umami_aa?.toString()||"0")/1e3*100)}%`}})}),r.jsx("span",{className:"text-xs text-gray-400 tabular-nums w-8 text-right",children:parseFloat(n.umami_aa?.toString()||"0").toFixed(0)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[r.jsx("div",{className:"chart-element w-2 h-2 bg-yellow-600 flex-shrink-0"}),r.jsx("div",{className:"chart-element flex-1 h-1.5 bg-gray-200 overflow-hidden min-w-0",children:r.jsx("div",{className:"h-full bg-yellow-600 transition-all duration-300",style:{width:`${Math.min(100,parseFloat(n.umami_nuc?.toString()||"0")/500*100)}%`}})}),r.jsx("span",{className:"text-xs text-gray-400 tabular-nums w-8 text-right",children:parseFloat(n.umami_nuc?.toString()||"0").toFixed(0)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[r.jsx("div",{className:"chart-element w-2 h-2 bg-purple-400 flex-shrink-0"}),r.jsx("div",{className:"chart-element flex-1 h-1.5 bg-gray-200 overflow-hidden min-w-0",children:r.jsx("div",{className:"h-full bg-purple-400 transition-all duration-300",style:{width:`${Math.min(100,parseFloat(n.umami_synergy?.toString()||"0")/1500*100)}%`}})}),r.jsx("span",{className:"text-xs text-gray-400 tabular-nums w-8 text-right",children:parseFloat(n.umami_synergy?.toString()||"0").toFixed(0)})]})]})})]}),u&&(0,r.jsxs)("div",{className:"mb-2 text-xs text-gray-600 space-y-1",children:[r.jsx("div",{className:"font-medium",children:"TCM"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[c.length>0&&(0,r.jsxs)("span",{children:[c.slice(0,3).join(", "),c.length>3?"…":""]}),c.length>0&&m.length>0&&r.jsx("span",{children:"•"}),m.length>0&&r.jsx("span",{children:m.join(", ")})]})]}),(p.length>0||v.length>0)&&(0,r.jsxs)("div",{className:"mb-2 space-y-2",children:[p.length>0&&r.jsx(TagRow,{items:p,map:x,label:"Allergens"}),v.length>0&&(0,r.jsxs)("div",{className:"text-xs text-gray-700 space-y-1",children:[r.jsx("div",{className:"font-medium",children:"Dietary"}),(0,r.jsxs)("div",{className:"space-y-1",children:[b&&r.jsx("div",{className:"break-words",title:b,children:b}),w&&r.jsx("div",{className:"break-words",title:v.slice(2).join(", "),children:w})]})]})]}),!!t&&r.jsx("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),t?.(e),window.location.href="/"},className:"mt-auto w-full flex items-center justify-center bg-gray-900 text-white text-xs font-medium py-2 hover:bg-gray-800 transition-colors",title:"Add to combo","aria-label":"Add to combo",children:"+ Add to combo"})]})}var p=a(2385);function getUmamiLevel(e){return e<10?{level:"sub-threshold",name:"Sub-threshold",range:"< 10 mg/100g",color:"text-gray-500",textColor:"text-gray-500",suggestion:"Umami is barely perceptible. Consider adding umami-rich ingredients such as mushrooms, tomatoes, or seaweed."}:e>=10&&e<80?{level:"biological",name:"Biological Range",range:"10-80 mg/100g",color:"text-fuchsia-600",textColor:"text-fuchsia-600",suggestion:"Natural umami perception. Add mild umami boosters for better balance."}:e>=80&&e<300?{level:"culinary-optimal",name:"Culinary Optimal",range:"80-300 mg/100g",color:"text-fuchsia-700",textColor:"text-fuchsia-700",suggestion:"Ideal balanced flavor zone. Maintain the current balance for best results."}:e>=300&&e<500?{level:"strong",name:"Strong Umami",range:"300-500 mg/100g",color:"text-fuchsia-800",textColor:"text-fuchsia-800",suggestion:"Very rich flavor near the practical upper culinary limit. Consider slightly reducing umami-heavy ingredients."}:e>=500&&e<2600?{level:"overlimit",name:"Overlimit Zone",range:"500-2600 mg/100g",color:"text-fuchsia-900",textColor:"text-fuchsia-900",suggestion:"Exceeding normal culinary range. Reduce umami-rich ingredients significantly to restore balance."}:{level:"theoretical-max",name:"Theoretical Maximum",range:"2600-3300 mg/100g",color:"text-fuchsia-950",textColor:"text-fuchsia-950",suggestion:"Deep umami saturation. Use dilution or add contrasting flavors for better harmony and complexity."}}function formatUmamiMg(e){return e<1?e.toFixed(2):e<10?e.toFixed(1):Math.round(e).toString()}function getUmamiColor(e){let t=getUmamiLevel(e);return t.textColor}function TCMBars({tcm:e,distributions:t,onQiAddClick:a,onFlavorAddClick:s,onMeridianAddClick:l,className:i=""}){let buildSegments=(e,t,a,r)=>{let s=a&&Object.keys(a).length>0?Object.entries(a):Array.from(new Set(e)).map(e=>[e,1]);if(0===s.length)return[];let l=s.reduce((e,[,t])=>e+Number(t),0)||1,i=s.map(([e,t])=>({label:String(e),value:Number(t)})).sort((e,t)=>t.value-e.value),n=100,o=i.map((e,a)=>{let s=e.value/l*100,o=a===i.length-1?Math.max(0,n):Math.round(10*s)/10;n=Math.max(0,n-o);let d=r?r(e.label):e.label;return{name:d,originalName:e.label,value:o,color:t[d]||"#D1D1D1"}}).filter(e=>e.value>0),d=100-o.reduce((e,t)=>e+t.value,0);return o.length>0&&Math.abs(d)>=.1&&(o[o.length-1].value=Math.max(0,o[o.length-1].value+d)),o},n=buildSegments(e.four_qi,{Cold:"#6FB7E8",Cool:"#9BB9E8",Neutral:"#D1D1D1",Warm:"#E8B4CB",Hot:"#E89BB9","Slightly Warm":"#E8B4CB","Slightly Cold":"#9BB9E8",Variable:"#D1D1D1"},t?.four_qi),o=buildSegments(e.five_flavors,{Bitter:"#C8E6C9",Sour:"#FFF9C4",Salty:"#E1E1E1",Sweet:"#F8BBD9",Pungent:"#FFAB91",Bland:"#F5F5F5"},t?.five_flavors,e=>"spicy"===e.toLowerCase()?"Pungent":e),d=(()=>{if(t?.meridians&&Object.keys(t.meridians).length>0){let e=Object.values(t.meridians).reduce((e,t)=>e+t,0)||1;return Object.entries(t.meridians).filter(([,e])=>e>0).map(([t,a])=>({label:t,value:Math.round(a/e*100)})).sort((e,t)=>t.value-e.value)}if(0===e.meridians.length)return[];let a=100/e.meridians.length;return Array.from(new Set(e.meridians)).map(e=>({label:e,value:Math.round(a)}))})(),renderStackedBar=(e,t,a,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-gray-700",children:e}),r.jsx("p",{className:"text-xs text-gray-500",children:t})]}),s&&r.jsx("button",{onClick:s,className:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors",children:r.jsx(p.Z,{className:"w-4 h-4 text-gray-600"})})]}),r.jsx("div",{className:"h-5 bg-gray-100 rounded overflow-hidden flex",children:a.map(e=>r.jsx("div",{className:"h-full",style:{width:`${e.value}%`,backgroundColor:e.color},title:`${e.name} ${e.value.toFixed(0)}%`},e.name))}),r.jsx("div",{className:"flex flex-wrap gap-2 mt-2 text-xs text-gray-600",children:a.map(e=>(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),e.name," ",e.value.toFixed(0),"%"]},e.name))})]}),c=d.length>0?d.map(e=>`${e.label} ${e.value}%`).join(" \xb7 "):"Not specified";return(0,r.jsxs)("div",{className:`space-y-4 ${i}`,children:[n.length>0&&renderStackedBar("Four Natures","Thermal energy balance across ingredients",n,a),o.length>0&&renderStackedBar("Five Tastes","Flavor-energy interaction for organ targeting",o,s),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Meridian Tropism"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Energy pathways to specific organ systems"})]}),l&&r.jsx("button",{onClick:l,className:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors",children:r.jsx(p.Z,{className:"w-4 h-4 text-gray-600"})})]}),r.jsx("p",{className:"text-xs text-gray-600",children:c})]})]})}function UmamiChart({chemistry:e,onAddClick:t,className:a="",showIndividual:s=!0}){let l=parseFloat(e.umami_aa?.toString()||"0"),i=parseFloat(e.umami_nuc?.toString()||"0"),n=parseFloat(e.umami_synergy?.toString()||"0"),o=l+i+n,d=Math.max(l,i,n,1),c=(()=>{if(i<=0)return!1;let e=l/i;return e>=.7&&e<=1.5})(),m=getUmamiLevel(o),u=getUmamiColor(o);return(0,r.jsxs)("div",{className:`space-y-3 ${a}`,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Umami Profile"}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["Total: ",(0,r.jsxs)("span",{className:u,children:[formatUmamiMg(o)," mg/100g"]})," \xb7 ",m.name]})]}),t&&r.jsx("button",{onClick:t,className:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors",children:r.jsx(p.Z,{className:"w-4 h-4 text-gray-600"})})]}),r.jsx("div",{className:"space-y-1.5",children:[{label:s?"Amino Acids":"AA",value:l,color:"bg-orange-500",text:s?"Glu, Asp":"",emphasis:!1},{label:s?"Nucleotides":"Nuc",value:i,color:"bg-yellow-600",text:s?"IMP, GMP, AMP":"",emphasis:!1},{label:"Synergy",value:n,color:"bg-purple-400",text:c?"Enhanced":"Baseline",emphasis:!0}].map(e=>(0,r.jsxs)("div",{className:"grid grid-cols-[90px_60px_minmax(0,1fr)] items-center gap-2",children:[r.jsx("span",{className:"text-xs text-gray-600",children:e.label}),(0,r.jsxs)("span",{className:"text-xs text-gray-500 text-right",children:[formatUmamiMg(e.value)," mg"]}),r.jsx("div",{className:"h-6 bg-gray-200 rounded overflow-hidden",children:r.jsx("div",{className:`h-full transition-all duration-300 px-2 flex items-center ${e.color}`,style:{width:`${d>0?e.value/d*100:0}%`},children:e.value>0&&e.text&&r.jsx("span",{className:`text-xs font-medium whitespace-nowrap ${e.emphasis?c?"text-gray-700":"text-purple-900/70":"text-white"}`,children:e.text})})})]},e.label))})]})}function MiniBars({chemistry:e,className:t=""}){let a=Number(e.umami_aa||0),s=Number(e.umami_nuc||0),l=Number(e.umami_synergy||0),i=Math.min(a/300*100,100),n=Math.min(s/50*100,100),o=Math.min(l/2600*100,100),d=[{label:"AA",value:a,displayValue:formatUmamiMg(a),color:"bg-umami-aa",normalized:i},{label:"Nuc",value:s,displayValue:formatUmamiMg(s),color:"bg-umami-nuc",normalized:n},{label:"Syn",value:l,displayValue:formatUmamiMg(l),color:"bg-umami-synergy",normalized:o}];return r.jsx("div",{className:`space-y-1 ${t}`,children:d.map(e=>(0,r.jsxs)("div",{className:"grid grid-cols-[32px_40px_minmax(0,1fr)] items-center gap-1 text-xs text-gray-500",children:[r.jsx("span",{className:"text-right",children:e.label}),r.jsx("span",{className:"text-right text-[10px]",children:e.displayValue}),r.jsx("div",{className:"h-2 bg-gray-200 rounded overflow-hidden",children:r.jsx("div",{className:`h-full transition-all duration-300 ${e.color}`,style:{width:`${e.normalized}%`},title:`${e.displayValue} mg (${e.normalized.toFixed(0)}% of P95)`})})]},e.label))})}let y={query:"",umami:[],flavor:[],qi:[],flavors:[],meridians:[],allergens_include:[],allergens_exclude:[],dietary:[],category:[],ranges:{},sort:"relevance"},f=[{value:"g",label:"g"},{value:"oz",label:"oz"},{value:"tsp",label:"tsp"},{value:"tbsp",label:"tbsp"},{value:"cup",label:"cup"}],v={g:1,oz:28.35,tsp:5,tbsp:15,cup:240},convertToGrams=(e,t)=>{let a=v[t?.toLowerCase?.()||"g"]||1;return e*a},normalizeFlavorLabel=e=>"spicy"===e.toLowerCase()?"Pungent":e;function StructuredSearch({onAddToComposition:e,onOpenDetails:t,composition:a,onChange:l,className:d=""}){let[c,m]=(0,s.useState)(y),[u,g]=(0,s.useState)([]),[x,h]=(0,s.useState)(!1),[p,v]=(0,s.useState)(0),[b,j]=(0,s.useState)(1),[N,w]=(0,s.useState)(!0),[_,C]=(0,s.useState)(!1),[S,F]=(0,s.useState)("Combo title"),[k,E]=(0,s.useState)(!1),[M,A]=(0,s.useState)(!1),[P,$]=(0,s.useState)(!1),[q,T]=(0,s.useState)(null),[D,L]=(0,s.useState)({}),U=(0,s.useMemo)(()=>{let e=new Map;return a.result?.ingredients?.forEach(t=>{e.set(t.id,t.quantity_grams)}),e},[a.result]),{aggregatedQi:I,aggregatedFlavors:B,aggregatedMeridians:R,qiDistribution:z,flavorDistribution:O,meridianDistribution:Z}=(0,s.useMemo)(()=>{let e=new Map,t=new Map,r=new Map;a.ingredients.forEach(a=>{let s=a.ingredient.tcm;if(!s)return;let l=U.get(a.ingredient.id)??convertToGrams(a.quantity,a.unit);if(!l||l<=0)return;let distribute=(e,t,a)=>{if(!e||0===e.length)return;let r=Array.from(new Set(e)),s=l/r.length;r.forEach(e=>{let r=a?a(e):e;t.set(r,(t.get(r)||0)+s)})};distribute(s.four_qi,e),distribute(s.five_flavors,t,normalizeFlavorLabel),distribute(s.meridians,r)});let toDistribution=e=>{if(0===e.size)return;let t=Array.from(e.values()).reduce((e,t)=>e+t,0);if(0===t)return;let a=Array.from(e.entries()).map(([e,a])=>[e,a/t*100]);return a.sort((e,t)=>t[1]-e[1]),{distribution:Object.fromEntries(a),order:a.map(([e])=>e)}},fallback=(e,t)=>Array.from(new Set(a.ingredients.flatMap(a=>{let r=e(a.ingredient.tcm);return r?r.map(e=>t?t(e):e):[]}))),s=toDistribution(e),l=toDistribution(t),i=toDistribution(r);return{aggregatedQi:s?.order??fallback(e=>e?.four_qi),aggregatedFlavors:l?.order??fallback(e=>e?.five_flavors,normalizeFlavorLabel),aggregatedMeridians:i?.order??fallback(e=>e?.meridians),qiDistribution:s?.distribution,flavorDistribution:l?.distribution,meridianDistribution:i?.distribution}},[a.ingredients,U]),K=c.query.trim().length>0,V=c.umami.length>0||c.flavor.length>0||c.qi.length>0||c.flavors.length>0||c.meridians.length>0||c.allergens_exclude.length>0||c.dietary.length>0||c.category.length>0,Q=K||V;(0,s.useEffect)(()=>{let fetchTotalCount=async()=>{try{let e=await searchIngredients(y,1,1),t=e.count||0;T(t),Q||v(t)}catch(e){console.error("Error fetching ingredient count:",e)}};fetchTotalCount()},[]),(0,s.useEffect)(()=>{if("relevance"!==c.sort||c.query.trim())return;let e={umami_aa:"aa",umami_nuc:"nuc",umami_synergy:"synergy"},t=c.umami.find(t=>e[t])?e[c.umami.find(t=>e[t])]:void 0;t&&t!==c.sort&&m(e=>({...e,sort:t}))},[c.umami,c.query,c.sort]),(0,s.useEffect)(()=>{updateComposition()},[a.ingredients]);let updateComposition=async()=>{if(0===a.ingredients.length){l({...a,result:void 0}),M||F("Combo title");return}$(!0);try{let e=a.ingredients.map(e=>({ingredient_id:e.ingredient.id,quantity:e.quantity,unit:e.unit})),t=await composePreview(e);l({...a,result:t})}catch(e){console.error("Error updating composition:",e)}finally{$(!1)}},G=(0,s.useCallback)(async(e,t=1,a=!1)=>{if(!e.query.trim()&&!V){g([]),v(q??0),C(!1);return}h(!0),C(!0);try{let r=await searchIngredients(e,t);a||1===t?g(r.results||[]):g(e=>[...e,...r.results||[]]),v(r.count||0),j(t),w(t<(r.total_pages||1))}catch(e){console.error("❌ API Error:",e),g([]),v(q??0),w(!1)}finally{h(!1)}},[V,q]);(0,s.useEffect)(()=>{let e=setTimeout(()=>{G(c,1,!0)},300);return()=>clearTimeout(e)},[c,G]);let handleFilterChange=e=>{m(e)},handleAddIngredient=t=>{e&&e(t),C(!1)},handleClearFilters=()=>{m(y),g([]),v(q??0),C(!1)},removeIngredient=e=>{let t=a.ingredients.filter(t=>t.ingredient.id!==e);l({...a,ingredients:t})},updateQuantity=(e,t)=>{let r=a.ingredients.map(a=>a.ingredient.id===e?{...a,quantity:t}:a);l({...a,ingredients:r})},handleQuantityFocus=e=>{e.target.select()},handleQuantityChange=(e,t)=>{L(a=>({...a,[e]:t}))},handleQuantityBlur=e=>{let t=D[e];if(void 0!==t){let a=parseFloat(t)||0;updateQuantity(e,a),L(t=>{let a={...t};return delete a[e],a})}},handleQuantityKeyDown=(e,t)=>{"Enter"===e.key&&e.currentTarget.blur()},updateUnit=(e,t)=>{let r=a.ingredients.map(a=>a.ingredient.id===e?{...a,unit:t}:a);l({...a,ingredients:r})},isInteractiveTarget=e=>e instanceof HTMLElement&&e.closest('button, input, select, textarea, a, [role="button"]'),handleComboCardClick=(e,a)=>{!t||isInteractiveTarget(e.target)||t(a)},handleComboCardKeyDown=(e,a)=>{t&&("Enter"===e.key||" "===e.key)&&(isInteractiveTarget(e.target)||(e.preventDefault(),t(a)))},handleTitleSave=()=>{E(!1),A(S.trim().length>0)};return(0,s.useEffect)(()=>{if(M)return;if(0===a.ingredients.length){F("Combo title");return}let e=a.ingredients.map(e=>{let t=Number.isFinite(e.quantity)&&e.quantity>0?e.quantity:1;return{name:e.ingredient.display_name||e.ingredient.base_name,weight:t}});e.sort((e,t)=>t.weight!==e.weight?t.weight-e.weight:e.name.localeCompare(t.name));let t=e.map(e=>e.name).join(" & ");t&&F(t)},[a.ingredients,M]),(0,r.jsxs)("div",{className:`space-y-6 ${d}`,children:[(0,r.jsxs)("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:r.jsx(i.Z,{className:"h-5 w-5 text-gray-400"})}),r.jsx("input",{type:"text",value:c.query,onChange:e=>handleFilterChange({...c,query:e.target.value}),placeholder:"Search ingredients by name, umami properties, or TCM attributes...",className:"block w-full pl-12 pr-12 py-3 h-11 text-base border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent shadow-lg transition-all"}),(K||V)&&r.jsx("button",{onClick:handleClearFilters,className:"absolute inset-y-0 right-0 pr-4 flex items-center",children:r.jsx(n.Z,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"flex-1 overflow-x-auto",children:r.jsx(FilterRow,{filters:c,onChange:handleFilterChange,resultCount:p,compact:!0,onClearFilters:handleClearFilters,showResultCount:!1})}),r.jsx(SortSelect,{value:c.sort,onChange:e=>handleFilterChange({...c,sort:e}),className:"flex-shrink-0"})]}),r.jsx("div",{children:r.jsx("p",{className:"text-sm text-gray-600",children:Q?x?"Searching...":`${p} ingredients found${K?` for "${c.query}"`:""}`:null!=q?`${q.toLocaleString()} ingredients available`:"Loading ingredient catalog…"})}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[k?r.jsx("input",{type:"text",value:S,onChange:e=>F(e.target.value),onBlur:handleTitleSave,onKeyDown:e=>"Enter"===e.key&&handleTitleSave(),className:"flex-1 text-xl font-semibold text-gray-900 bg-transparent border-b-2 border-blue-500 focus:outline-none",autoFocus:!0}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:()=>E(!0),className:"p-1 mr-1 rounded-lg hover:bg-gray-100 text-gray-500 hover:text-gray-700 transition-colors","aria-label":"Edit combo title",children:r.jsx(o.Z,{className:"w-4 h-4"})}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900 flex-1",children:S})]}),a.ingredients.length>0&&r.jsx("button",{onClick:()=>{g([]),C(!1),l({...a,ingredients:[],result:void 0})},className:"px-3 py-2 text-sm text-black hover:text-gray-700",children:"Clear all"})]}),a.ingredients.length>0&&r.jsx("div",{className:"flex flex-wrap items-center gap-2",children:a.ingredients.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>removeIngredient(e.ingredient.id),className:"px-3 py-1 bg-gray-200 hover:bg-gray-300 text-xs font-medium text-gray-700 border border-gray-300 transition-colors",children:[e.ingredient.display_name||e.ingredient.base_name,r.jsx("span",{className:"ml-2 text-gray-500",children:"\xd7"})]},`chip-${e.ingredient.id}`))}),(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-6 space-y-6",children:[a.ingredients.length>0&&a.result?(0,r.jsxs)(r.Fragment,{children:[r.jsx(UmamiChart,{chemistry:{glu:parseFloat(String(a.result.total_glu)),asp:parseFloat(String(a.result.total_asp)),imp:parseFloat(String(a.result.total_imp)),gmp:parseFloat(String(a.result.total_gmp)),amp:parseFloat(String(a.result.total_amp)),umami_aa:parseFloat(String(a.result.total_aa)),umami_nuc:parseFloat(String(a.result.total_nuc)),umami_synergy:parseFloat(String(a.result.total_synergy))},showIndividual:!1}),r.jsx(TCMBars,{tcm:{four_qi:I,five_flavors:B,meridians:R,overview:"",confidence:1},distributions:{four_qi:z,five_flavors:O,meridians:Z}})]}):r.jsx("div",{className:"flex flex-col items-center text-sm text-gray-500 gap-3",children:P?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}),r.jsx("span",{children:"Calculating composition…"})]}):r.jsx("span",{children:"Add ingredients to preview umami and TCM analytics."})}),P&&a.result&&r.jsx("div",{className:"flex justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})})]}),r.jsx("div",{className:"space-y-3",children:0===a.ingredients.length?r.jsx("p",{className:"text-gray-500 text-center py-8 bg-gray-50 rounded-xl",children:"No ingredients selected yet. Search and add ingredients above."}):r.jsx("div",{className:"overflow-x-auto",children:r.jsx("div",{className:"flex gap-3 pb-2",children:a.ingredients.map(e=>(0,r.jsxs)("div",{className:`paper-texture-light border border-gray-200 p-4 flex flex-col gap-3 min-w-[260px] max-w-[260px] flex-shrink-0 transition-colors ${t?"cursor-pointer hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300":""}`,onClick:t=>handleComboCardClick(t,e.ingredient),onKeyDown:t=>handleComboCardKeyDown(t,e.ingredient),role:t?"button":void 0,tabIndex:t?0:void 0,children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h4",{className:"text-base font-medium text-gray-900 leading-snug min-h-[2.75rem] overflow-hidden",title:e.ingredient.display_name||e.ingredient.base_name,children:e.ingredient.display_name||e.ingredient.base_name}),(0,r.jsxs)("div",{className:"text-xs text-gray-600 mt-1 truncate",children:[(e.ingredient.tcm?.five_flavors||["Sweet"]).map(normalizeFlavorLabel).join(", ")," • ",(e.ingredient.tcm?.four_qi||["Neutral"]).join(", ")]})]}),r.jsx("button",{onClick:t=>{t.stopPropagation(),removeIngredient(e.ingredient.id)},className:"btn-circular-sm text-gray-400 hover:text-red-500 hover:bg-red-50","aria-label":`Remove ${e.ingredient.display_name||e.ingredient.base_name}`,children:r.jsx(n.Z,{className:"w-4 h-4"})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"number",value:D[e.ingredient.id]??e.quantity,onChange:t=>handleQuantityChange(e.ingredient.id,t.target.value),onFocus:handleQuantityFocus,onBlur:()=>handleQuantityBlur(e.ingredient.id),onKeyDown:t=>handleQuantityKeyDown(t,e.ingredient.id),className:"w-20 px-2 py-1 border border-gray-300 text-sm",min:"0",step:"0.1",onClick:e=>e.stopPropagation()}),r.jsx("select",{value:e.unit,onChange:t=>updateUnit(e.ingredient.id,t.target.value),className:"w-20 px-2 py-1 border border-gray-300 text-sm",onClick:e=>e.stopPropagation(),children:f.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))})]}),e.ingredient.chemistry&&r.jsx(MiniBars,{chemistry:e.ingredient.chemistry}),(0,r.jsxs)("div",{className:"text-xs text-gray-600 space-y-1",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-medium",children:"Allergens:"})," ",e.ingredient.flags?.allergens?.length?e.ingredient.flags.allergens.join(", "):"None reported"]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-medium",children:"TCM:"})," ",(e.ingredient.tcm?.five_flavors||["Sweet"]).map(normalizeFlavorLabel).join(", ")," • ",(e.ingredient.tcm?.four_qi||["Neutral"]).join(", ")]}),(e.ingredient.flags?.dietary_restrictions?.length??0)>0&&(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-medium",children:"Dietary:"})," ",e.ingredient.flags?.dietary_restrictions?.slice(0,4).join(", ")]})]})]},e.ingredient.id))})})}),Q&&_&&(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col",style:{background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)"},children:[r.jsx("div",{className:"bg-white/95 backdrop-blur-sm border-b border-white/40 p-4",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[(0,r.jsxs)("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:r.jsx(i.Z,{className:"h-5 w-5 text-gray-400"})}),r.jsx("input",{type:"text",value:c.query,onChange:e=>handleFilterChange({...c,query:e.target.value}),placeholder:"Search ingredients...",className:"block w-full pl-12 pr-12 py-3 h-11 text-base border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),r.jsx("button",{onClick:()=>C(!1),className:"btn-circular-sm absolute top-1/2 right-2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 hover:bg-gray-100",children:r.jsx(n.Z,{className:"h-4 w-4"})})]}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"flex-1 overflow-x-auto",children:r.jsx(FilterRow,{filters:c,onChange:handleFilterChange,resultCount:p,compact:!0,onClearFilters:handleClearFilters,showResultCount:!1})}),r.jsx(SortSelect,{value:c.sort,onChange:e=>handleFilterChange({...c,sort:e}),className:"flex-shrink-0"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-6",children:[r.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:x?"Searching...":`${p} ingredients found`}),K&&(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:['Results for "',c.query,'"']})]}),u.length>0&&r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2 sm:gap-4 mb-6",children:u.map(e=>r.jsx("div",{className:"paper-texture-light border border-gray-300 h-full",children:r.jsx(IngredientCard,{ingredient:e,onAddToComposition:handleAddIngredient,onOpenDetails:t,compact:!0})},e.id))}),x&&(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Loading ingredients..."})]}),!x&&0===u.length&&(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No ingredients found"}),r.jsx("p",{className:"text-gray-600",children:"Try adjusting your search terms or filters."})]})]})})]})]})}var b=a(7114);let j=new Set(["halal","kosher"]),normaliseKey=e=>e.toLowerCase().replace(/[\s-]+/g,"_"),formatLabel=e=>e.replace(/[\s_-]+/g," ").trim().replace(/\b\w/g,e=>e.toUpperCase()),splitDietaryRestrictions=(e=[])=>{let t=[],a=[];return e.forEach(e=>{let r=normaliseKey(e);j.has(r)?t.push(formatLabel(e)):a.push(formatLabel(e))}),{religious:t,other:a}},formatAlias=(e,t)=>t?`${e} (${formatLabel(t)})`:e;function IngredientDetailModal({ingredientId:e,onClose:t,onAddToComposition:a,className:l=""}){let[i,o]=(0,s.useState)(null),[d,c]=(0,s.useState)(!0),[m,u]=(0,s.useState)(null);if((0,s.useEffect)(()=>{if(!e){o(null),c(!1);return}let fetchIngredient=async()=>{c(!0),u(null);try{let t=await getIngredient(e);o(t)}catch(e){u(e?.message||"Failed to load ingredient details"),console.error("Error fetching ingredient:",e)}finally{c(!1)}};fetchIngredient()},[e]),!e)return null;let g=i?.display_name||i?.base_name,x=i?.tcm?.overview||i?.cooking_overview,h=g?`${g} is a versatile ingredient valued for its culinary applications and balanced umami profile.`:"This ingredient offers a balanced umami contribution and flexible pairing options.",y=i?.flags?.allergens??[];y.map(formatLabel),i&&splitDietaryRestrictions(i.flags?.dietary_restrictions??[]);let f=i?.tcm?.five_flavors??[],v=i?.tcm?.four_qi??[],b=i?.tcm?.meridians??[],j=i?.aliases?.map(e=>formatAlias(e.name,e.language)).join(", ");return(0,r.jsxs)("div",{className:`fixed inset-0 z-50 overflow-y-auto ${l}`,children:[r.jsx("div",{className:"fixed inset-0 bg-black/40 transition-opacity",onClick:t}),r.jsx("div",{className:"flex min-h-full items-center justify-center p-2 sm:p-4",children:(0,r.jsxs)("div",{className:"relative paper-texture-light w-full max-w-5xl max-h-[95vh] overflow-hidden border border-gray-300",children:[r.jsx("button",{onClick:t,className:"btn-circular absolute top-4 right-4 z-10 bg-gray-100 hover:bg-gray-200 transition-all border border-gray-300",children:r.jsx(n.Z,{className:"w-5 h-5 text-gray-600"})}),(0,r.jsxs)("div",{className:"max-h-[95vh] overflow-y-auto scrollbar-hide",children:[d&&(0,r.jsxs)("div",{className:"text-center py-20",children:[r.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-500"}),r.jsx("p",{className:"mt-4 text-gray-600 text-lg",children:"Loading ingredient details..."})]}),m&&r.jsx("div",{className:"text-center py-20",children:r.jsx("p",{className:"text-red-600 text-lg",children:m})}),i&&!d&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("section",{className:"px-4 sm:px-8 pt-12 pb-8 bg-white border-b border-gray-200",children:(0,r.jsxs)("div",{className:"grid gap-6 sm:gap-8 lg:grid-cols-[minmax(0,2fr)_1fr] items-start",children:[(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[i.category&&r.jsx("span",{className:"text-xs uppercase tracking-wide text-gray-500",children:i.category}),r.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold text-gray-900",children:g}),r.jsx("p",{className:"text-sm leading-relaxed text-gray-600",children:x||h})]}),r.jsx("div",{className:"grid gap-4 sm:grid-cols-2 text-sm text-gray-700",children:(f.length>0||v.length>0)&&(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("div",{className:"text-xs font-medium uppercase text-gray-500",children:"TCM focus"}),r.jsx("p",{className:"leading-relaxed",children:[f.slice(0,3).join(", "),v.join(", ")].filter(Boolean).join(" • ")||"Balanced profile"})]})})]}),(0,r.jsxs)("div",{className:"space-y-4 rounded border border-gray-200 bg-white p-4 sm:p-6",children:[(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-gray-900",children:"Composition"}),(0,r.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Add ",g," directly to your composition workspace."]})]}),a&&(0,r.jsxs)("button",{onClick:()=>{i&&a&&(a(i),t(),window.location.href="/")},className:"w-full flex items-center justify-center gap-2 bg-gray-900 text-white text-sm font-medium py-2 hover:bg-gray-800 transition-colors",children:[r.jsx(p.Z,{className:"w-4 h-4"}),r.jsx("span",{children:"+ Add to combo"})]}),(0,r.jsxs)("div",{className:"pt-3 border-t border-gray-200 text-xs text-gray-500 space-y-1",children:[(0,r.jsxs)("div",{children:["Base name: ",i.base_name]}),j&&(0,r.jsxs)("div",{children:["Aliases: ",j]})]})]})]})}),(0,r.jsxs)("section",{className:"px-4 sm:px-8 py-8 bg-white space-y-8",children:[(0,r.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[i.chemistry&&r.jsx("div",{className:"paper-texture-light border border-gray-200 p-4 sm:p-6",children:r.jsx(UmamiChart,{chemistry:i.chemistry})}),i.tcm&&r.jsx("div",{className:"paper-texture-light border border-gray-200 p-4 sm:p-6",children:r.jsx(TCMBars,{tcm:i.tcm})})]}),(b.length>0||i.similar?.length||i.complementary?.length)&&(0,r.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[b.length>0&&(0,r.jsxs)("div",{className:"paper-texture-light border border-gray-200 p-4 sm:p-6 space-y-3",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Meridian Guidance"}),(0,r.jsxs)("p",{className:"text-sm text-gray-700 leading-relaxed",children:[g," interacts with the following meridians:"]}),r.jsx("ul",{className:"text-sm text-gray-600 space-y-1 list-disc list-inside",children:b.map(e=>r.jsx("li",{children:formatLabel(e)},e))})]}),(i.similar?.length||i.complementary?.length)&&(0,r.jsxs)("div",{className:"paper-texture-light border border-gray-200 p-4 sm:p-6 space-y-3",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Pairing Notes"}),i.complementary?.length?(0,r.jsxs)("div",{className:"text-sm text-gray-700",children:[r.jsx("div",{className:"text-xs font-medium uppercase text-gray-500 mb-1",children:"Synergistic partners"}),r.jsx("ul",{className:"space-y-1 list-disc list-inside text-gray-600",children:i.complementary.slice(0,4).map(e=>r.jsx("li",{children:e.display_name||e.base_name},e.id))})]}):null,i.similar?.length?(0,r.jsxs)("div",{className:"text-sm text-gray-700",children:[r.jsx("div",{className:"text-xs font-medium uppercase text-gray-500 mb-1",children:"Similar profile"}),r.jsx("ul",{className:"space-y-1 list-disc list-inside text-gray-600",children:i.similar.slice(0,4).map(e=>r.jsx("li",{children:e.display_name||e.base_name},e.id))})]}):null]})]}),(0,r.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,r.jsxs)("div",{className:"paper-texture-light border border-gray-200 p-4 sm:p-6 space-y-3",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Overview"}),r.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:x||h})]}),(0,r.jsxs)("div",{className:"paper-texture-light border border-gray-200 p-4 sm:p-6 space-y-3",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Preparation"}),(0,r.jsxs)("ul",{className:"text-sm text-gray-700 space-y-2",children:[i.extraction_temp&&(0,r.jsxs)("li",{children:[r.jsx("span",{className:"font-medium text-gray-900",children:"Extraction temperature:"})," ",i.extraction_temp,"\xb0C"]}),i.extraction_time&&(0,r.jsxs)("li",{children:[r.jsx("span",{className:"font-medium text-gray-900",children:"Extraction time:"})," ",i.extraction_time," minutes"]}),!i.extraction_temp&&!i.extraction_time&&r.jsx("li",{children:"Gentle heating preserves umami compounds; avoid prolonged high-temperature cooking."})]})]})]})]})]})]})]})})]})}function useIngredientModal(){let e=(0,b.useRouter)(),t=(0,b.useSearchParams)(),a=t.get("ingredient");return{ingredientId:a?parseInt(a,10):null,openModal:a=>{let r=new URLSearchParams(t.toString());r.set("ingredient",a.toString()),e.push(`?${r.toString()}`)},closeModal:()=>{let a=new URLSearchParams(t.toString());a.delete("ingredient"),e.push(`?${a.toString()}`)}}}let N={ingredients:[],result:void 0};function HomePage(){let[e,t]=(0,s.useState)(N),{ingredientId:a,openModal:i,closeModal:n}=useIngredientModal();(0,s.useEffect)(()=>{let e=loadFromLocalStorage("umami-composition");e&&t(e);let a=window.location.hash;if(a.startsWith("#state="))try{let e=a.substring(7),r=JSON.parse(atob(e));r.ingredients&&t(r)}catch(e){console.error("Error loading shared state:",e)}},[]),(0,s.useEffect)(()=>{e.ingredients.length},[e]);let handleAddToComposition=a=>{let r=e.ingredients.some(e=>e.ingredient.id===a.id);if(!r){let r={...e,ingredients:[...e.ingredients,{ingredient:a,quantity:100,unit:"g"}]};t(r)}};return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(l.W,{}),r.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8",children:(0,r.jsxs)("div",{className:"space-y-6 sm:space-y-8",children:[r.jsx("div",{className:"text-center",children:r.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-gray-900",children:"Umami Builder"})}),r.jsx("div",{className:"text-center max-w-2xl mx-auto",children:r.jsx("p",{className:"text-base sm:text-lg text-gray-600",children:"Search and pair umami across different foods."})}),r.jsx("div",{className:"max-w-4xl mx-auto",children:r.jsx(StructuredSearch,{onAddToComposition:handleAddToComposition,onOpenDetails:e=>{i(e.id)},composition:e,onChange:t})})]})}),r.jsx(IngredientDetailModal,{ingredientId:a,onClose:n,onAddToComposition:handleAddToComposition})]})}},8203:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>i,__esModule:()=>l,default:()=>o});var r=a(5153);let s=(0,r.createProxy)(String.raw`/Users/chenjiashe/Desktop/Umamivers/frontend/src/app/page.tsx`),{__esModule:l,$$typeof:i}=s,n=s.default,o=n}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[815,263,762,789,323],()=>__webpack_exec__(2836));module.exports=a})();